<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Liquid IDE Mobile</title>
  <style>
    :root {
      --accent: #3b82f6;
      --glass: rgba(255, 255, 255, 0.03);
      --border: rgba(255, 255, 255, 0.1);
    }

    body {
      margin: 0; background: #0b0e14; color: #fff;
      font-family: -apple-system, sans-serif;
      height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
    }

    /* 背景の環境光エフェクト */
    .glow {
      position: fixed; width: 300px; height: 300px;
      background: var(--accent); filter: blur(120px);
      opacity: 0.15; z-index: -1; top: -50px; right: -50px;
    }

    /* 1. フレキシブル・レイアウト */
    header {
      padding: calc(env(safe-area-inset-top) + 10px) 15px 10px;
      background: var(--glass); backdrop-filter: blur(20px);
      display: flex; justify-content: space-between; align-items: center;
      border-bottom: 1px solid var(--border);
    }

    .main-container {
      flex: 1; display: flex; flex-direction: column;
      overflow: hidden; /* スクロールを内側に閉じ込める */
    }

    /* エディタ：画面の高さに応じて伸縮 */
    #editor {
      flex: 3; /* プレビューより広めに確保 */
      width: 100%; background: transparent; border: none;
      color: #79c0ff; font-family: "Menlo", "Cascadia Code", monospace;
      font-size: 14px; padding: 15px; outline: none; resize: none;
    }

    /* リアルタイムプレビューの小窓 (Flexible Resize) */
    .preview-pane {
      flex: 2; border-top: 1px solid var(--border);
      background: #fff; position: relative;
    }

    #previewFrame { width: 100%; height: 100%; border: none; }

    /* クイックツールバー：横スクロール対応 */
    .toolbar {
      padding: 8px; display: flex; gap: 6px; overflow-x: auto;
      background: #161b22; border-top: 1px solid var(--border);
      -webkit-overflow-scrolling: touch;
    }

    .tool-btn {
      flex-shrink: 0; padding: 6px 12px; background: #21262d;
      border: 1px solid var(--border); border-radius: 6px; color: #c9d1d9; font-size: 13px;
    }

    .status { font-size: 11px; color: #8b949e; }
    
    /* フル画面ボタン */
    .expand-btn {
      position: absolute; top: 10px; right: 10px;
      background: rgba(0,0,0,0.5); border: none; color: #fff;
      padding: 5px 10px; border-radius: 5px; font-size: 10px;
    }
  </style>
</head>
<body>
  <div class="glow"></div>
  
  <header>
    <div style="font-weight: bold; font-size: 14px;">LiquidConsole <span class="status" id="saveMsg">Live</span></div>
    <button onclick="toggleViewMode()" style="background:none; border:none; color:var(--accent); font-size:12px;">Toggle Layout</button>
  </header>

  <div class="main-container">
    <textarea id="editor" spellcheck="false" placeholder="Type HTML..."></textarea>
    
    <div class="toolbar" id="quickBar"></div>

    <div class="preview-pane" id="previewPane">
      <button class="expand-btn" onclick="fullPreview()">Full Screen</button>
      <iframe id="previewFrame"></iframe>
    </div>
  </div>

  <script>
    const editor = document.getElementById('editor');
    const preview = document.getElementById('previewFrame');
    const saveMsg = document.getElementById('saveMsg');
    let timer;

    // 1. リアルタイム・プレビュー（デバウンス処理）
    editor.addEventListener('input', () => {
      saveMsg.textContent = 'Typing...';
      clearTimeout(timer);
      
      // 300ms間入力が止まったら反映（負荷軽減）
      timer = setTimeout(() => {
        const code = editor.value;
        preview.srcdoc = code;
        localStorage.setItem('liquid_save', code);
        saveMsg.textContent = 'Live Sync';
      }, 300);
    });

    // 2. ローカルストレージからの復元
    window.onload = () => {
      const saved = localStorage.getItem('liquid_save');
      if (saved) {
        editor.value = saved;
        preview.srcdoc = saved;
      }
      renderTools();
    };

    // 3. UIフレキシブル調整（レイアウト切り替え）
    let isVertical = true;
    function toggleViewMode() {
      const container = document.querySelector('.main-container');
      isVertical = !isVertical;
      container.style.flexDirection = isVertical ? 'column' : 'row';
      editor.style.flex = '1';
      document.getElementById('previewPane').style.flex = '1';
    }

    // クイック入力（スマホ最適化）
    function renderTools() {
      const keys = ['<', '>', '/', '"', '=', '{', '}', '(', ')', ';', '.', '!', '?', '+'];
      const bar = document.getElementById('quickBar');
      keys.forEach(k => {
        const b = document.createElement('button');
        b.className = 'tool-btn';
        b.textContent = k;
        b.onclick = () => {
          const s = editor.selectionStart;
          editor.value = editor.value.substring(0, s) + k + editor.value.substring(editor.selectionEnd);
          editor.selectionStart = editor.selectionEnd = s + 1;
          editor.dispatchEvent(new Event('input')); // 反映をトリガー
          editor.focus();
        };
        bar.appendChild(b);
      });
    }

    function fullPreview() {
      preview.requestFullscreen ? preview.requestFullscreen() : preview.webkitRequestFullscreen();
    }
  </script>
</body>
</html>